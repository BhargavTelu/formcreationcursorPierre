<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Travel Planning Form</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .form-container {
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        .form-group {
            margin-bottom: 30px;
        }
        .question-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
        }
        .month-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        .month-block {
            position: relative;
        }
        .month-block input[type="checkbox"] {
            position: absolute;
            opacity: 0;
        }
        .month-block label {
            display: block;
            padding: 15px 10px;
            background-color: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        .month-block input[type="checkbox"]:checked + label {
            background-color: #2196F3;
            color: white;
            border-color: #2196F3;
        }
        .month-block label:hover {
            background-color: #e9ecef;
            border-color: #2196F3;
        }
        .month-block input[type="checkbox"]:checked + label:hover {
            background-color: #1976D2;
        }
        .date-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        .date-section label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        .date-section input[type="date"] {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            width: 200px;
        }
        .nights-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        .night-block {
            position: relative;
        }
        .night-block input[type="radio"] {
            position: absolute;
            opacity: 0;
        }
        .night-block label {
            display: block;
            padding: 15px 10px;
            background-color: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        .night-block input[type="radio"]:checked + label {
            background-color: #2196F3;
            color: white;
            border-color: #2196F3;
        }
        .night-block label:hover {
            background-color: #e9ecef;
            border-color: #2196F3;
        }
        .night-block input[type="radio"]:checked + label:hover {
            background-color: #1976D2;
        }
        .exact-nights-section {
            margin-top: 20px;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 6px;
        }
        .checkbox-container {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        .checkbox-container input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.2);
        }
        .checkbox-container label {
            font-weight: bold;
            color: #333;
        }
        .exact-input {
            margin-left: 30px;
        }
        .exact-input input[type="number"] {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            width: 100px;
        }
        .exact-input.disabled {
            opacity: 0.5;
            pointer-events: none;
        }
        
        /* Golf-specific styles */
        .golf-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }
        .golf-option {
            position: relative;
        }
        .golf-option input[type="radio"] {
            position: absolute;
            opacity: 0;
        }
        .golf-option label {
            display: block;
            padding: 15px 10px;
            background-color: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }
        .golf-option input[type="radio"]:checked + label {
            background-color: #2196F3;
            color: white;
            border-color: #2196F3;
        }
        .golf-option label:hover {
            background-color: #e9ecef;
            border-color: #2196F3;
        }
        .golf-option input[type="radio"]:checked + label:hover {
            background-color: #1976D2;
        }
        .golf-details {
            margin-top: 20px;
            padding: 20px;
            background-color: #e3f2fd;
            border-radius: 6px;
            border-left: 4px solid #2196F3;
            display: none;
        }
        .golf-details.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }
        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
            }
            to {
                opacity: 1;
                max-height: 200px;
            }
        }
        .golf-rounds-input {
            display: flex;
            align-items: center;
            margin-top: 15px;
        }
        .golf-rounds-input label {
            margin-right: 15px;
            font-weight: bold;
            color: #333;
            white-space: nowrap;
        }
        .golf-rounds-input input[type="number"] {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            width: 100px;
        }
        
        /* Destination selection styles */
        .destination-container {
            margin-top: 15px;
        }
        .destination-search-container {
            margin-bottom: 15px;
            position: relative;
        }
        .destination-search-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            box-sizing: border-box;
        }
        .destination-search-input:focus {
            border-color: #4CAF50;
            outline: none;
            box-shadow: 0 0 3px rgba(76, 175, 80, 0.3);
        }
        .destination-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 1px solid #ddd;
            border-radius: 0 0 4px 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            max-height: 200px;
            overflow-y: auto;
            z-index: 10;
            display: none;
        }
        .destination-suggestion-item {
            padding: 8px 12px;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
            font-size: 13px;
        }
        .destination-suggestion-item:last-child {
            border-bottom: none;
        }
        .destination-suggestion-item:hover {
            background-color: #f5f5f5;
        }
        .destination-suggestion-item.active {
            background-color: #e8f5e9;
        }
        .destination-suggestion-path {
            color: #777;
            font-size: 11px;
            margin-left: 6px;
        }
        .destination-add-custom {
            background-color: #f9f9f9;
            font-style: italic;
        }
        .destination-list {
            list-style-type: none;
            padding: 0;
            margin: 0;
            font-size: 14px;
        }
        .destination-item {
            margin-bottom: 6px;
            border-radius: 4px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        }
        .destination-main {
            background: linear-gradient(to bottom, #fafafa 0%, #f2f2f2 100%);
            padding: 10px 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            font-weight: 600;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
        }
        .destination-main:hover {
            background: linear-gradient(to bottom, #f5f5f5 0%, #e8e8e8 100%);
            border-color: #d0d0d0;
        }
        .destination-main.active {
            background: linear-gradient(to bottom, #4CAF50 0%, #43A047 100%);
            color: white;
            border-color: #388E3C;
        }
        .destination-toggle {
            margin-right: 8px;
            transition: transform 0.2s;
            display: inline-block;
            width: 16px;
            height: 16px;
            text-align: center;
            line-height: 16px;
            font-size: 12px;
        }
        .destination-toggle.open {
            transform: rotate(90deg);
        }
        .destination-checkbox {
            margin-right: 8px;
            transform: scale(1.1);
        }
        .sub-destinations {
            display: none;
            padding: 0;
            background-color: white;
            border-left: 1px solid #e9ecef;
            border-right: 1px solid #e9ecef;
            border-bottom: 1px solid #e9ecef;
            border-bottom-left-radius: 4px;
            border-bottom-right-radius: 4px;
            margin-top: -1px;
        }
        .sub-destinations.show {
            display: block;
            animation: fadeIn 0.2s ease-out;
        }
        .sub-destination-item {
            padding: 8px 12px;
            display: flex;
            align-items: center;
            cursor: pointer;
            border-bottom: 1px solid #f0f0f0;
        }
        .sub-destination-item:last-child {
            border-bottom: none;
        }
        .sub-destination-item:hover {
            background-color: #f8f9fa;
        }
        .sub-destination-label {
            margin-left: 6px;
            font-weight: 500;
            font-size: 13px;
        }
        .destination-checkbox-container {
            display: flex;
            align-items: center;
            width: 100%;
        }
        .nested-sub-destinations {
            display: none;
            padding: 0;
            background-color: #f9f9f9;
            margin-left: 0;
            border-left: 1px solid #e9ecef;
            width: 100%;
        }
        .nested-sub-destinations.show {
            display: block;
            animation: fadeIn 0.2s ease-out;
        }
        .nested-sub-item {
            padding: 7px 10px 7px 35px; /* Add left padding for indentation */
            display: flex;
            align-items: center;
            border-bottom: 1px solid #f0f0f0;
        }
        .nested-sub-item:last-child {
            border-bottom: none;
        }
        .nested-sub-item:hover {
            background-color: #f0f0f0;
        }
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        .selected-destinations-container {
            margin-top: 15px;
            padding: 10px;
            background-color: #e8f5e9;
            border-radius: 4px;
            border: 1px solid #c8e6c9;
        }
        .selected-destinations-title {
            font-weight: bold;
            margin-bottom: 8px;
            color: #2e7d32;
            font-size: 14px;
        }
        .selected-destinations-list {
            list-style-type: none;
            padding: 0;
            margin: 0;
        }
        .selected-destination-item {
            display: inline-block;
            background-color: #4CAF50;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            margin: 3px;
            font-size: 12px;
        }
        .selected-destination-remove {
            margin-left: 4px;
            cursor: pointer;
            font-size: 10px;
            vertical-align: middle;
        }
        
        /* General Section styles */
        .section-title {
            font-size: 22px;
            font-weight: bold;
            color: #333;
            margin-top: 40px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #4CAF50;
        }
        .travel-level-grid, .accommodation-type-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        .travel-level-option, .accommodation-option {
            position: relative;
        }
        .travel-level-option input[type="radio"], .accommodation-option input[type="radio"] {
            position: absolute;
            opacity: 0;
        }
        .travel-level-option label, .accommodation-option label {
            display: block;
            padding: 15px;
            background-color: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            height: 100%;
            box-sizing: border-box;
        }
        .travel-level-option label .option-title {
            font-weight: bold;
            display: block;
            margin-bottom: 8px;
            font-size: 16px;
        }
        .travel-level-option label .option-desc {
            font-size: 13px;
            color: #666;
            display: block;
        }
        .travel-level-option input[type="radio"]:checked + label {
            background-color: #4CAF50;
            color: white;
            border-color: #4CAF50;
        }
        .travel-level-option input[type="radio"]:checked + label .option-desc {
            color: #e8f5e9;
        }
        .travel-level-option label:hover {
            background-color: #e9ecef;
            border-color: #4CAF50;
        }
        .travel-level-option input[type="radio"]:checked + label:hover {
            background-color: #45a049;
        }
        
        .accommodation-option input[type="radio"]:checked + label {
            background-color: #673AB7;
            color: white;
            border-color: #673AB7;
        }
        .accommodation-option label:hover {
            background-color: #e9ecef;
            border-color: #673AB7;
        }
        .accommodation-option input[type="radio"]:checked + label:hover {
            background-color: #5E35B1;
        }
        
        .submit-btn {
            background-color: #4CAF50;
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 30px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        .submit-btn:hover {
            background-color: #45a049;
        }
        .submit-btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        /* Route preference styles */
        .route-preference-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        .route-option {
            position: relative;
        }
        .route-option input[type="radio"] {
            position: absolute;
            opacity: 0;
        }
        .route-option label {
            display: block;
            padding: 15px;
            background-color: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            height: 100%;
            box-sizing: border-box;
            font-weight: 500;
            font-size: 16px;
        }
        .route-option input[type="radio"]:checked + label {
            background-color: #FF9800;
            color: white;
            border-color: #FF9800;
        }
        .route-option label:hover {
            background-color: #e9ecef;
            border-color: #FF9800;
        }
        .route-option input[type="radio"]:checked + label:hover {
            background-color: #F57C00;
        }
        
        /* Pre-defined routes section styles */
        .predefined-routes-section {
            margin-top: 20px;
            padding: 20px;
            background-color: #fff3e0;
            border-radius: 6px;
            border-left: 4px solid #FF9800;
        }
        .route-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 10px;
        }
        .route-item {
            position: relative;
        }
        .route-item input[type="radio"] {
            position: absolute;
            opacity: 0;
        }
        .route-item label {
            display: block;
            padding: 12px 15px;
            background-color: #fff;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 14px;
            line-height: 1.4;
        }
        .route-item input[type="radio"]:checked + label {
            background-color: #FF9800;
            color: white;
            border-color: #FF9800;
        }
        .route-item label:hover {
            background-color: #f5f5f5;
            border-color: #FF9800;
        }
        .route-item input[type="radio"]:checked + label:hover {
            background-color: #F57C00;
        }
    </style>
</head>
<body>
    <div class="form-container">
        <h1>Travel Planning Form</h1>
        <form id="travelForm">
            <!-- Question 1: Client name -->
            <div class="form-group">
                <div class="question-title">1) Client name</div>
                <input type="text" id="clientName" name="clientName" placeholder="Enter your full name" required style="width: 180px; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px;">
            </div>
            <!-- Question 2: Number of travellers -->
            <div class="form-group">
                <div class="question-title">2) Number of travellers</div>
                <input type="number" id="numTravellers" name="numTravellers" min="1" max="20" value="2" placeholder="Enter number of travellers" required style="width: 180px; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px;">
            </div>
            <!-- Question 3: When do you want to travel? -->
            <div class="form-group">
                <div class="question-title">3) When do you want to travel?(multiple selections possible)</div>
                
                <div class="month-grid" id="monthGrid">
                    <!-- Months will be generated by JavaScript -->
                </div>
                
                <div class="date-section">
                    <label for="specificDate">Specific start date:</label>
                    <input type="date" id="specificDate" name="specificDate">
                </div>
            </div>

            <!-- Question 4: What kind of routes do you prefer? -->
            <div class="form-group">
                <div class="question-title">4) What kind of routes do you prefer?</div>
                
                <div class="route-preference-grid">
                    <div class="route-option">
                        <input type="radio" id="predefinedRoutes" name="routePreference" value="predefined">
                        <label for="predefinedRoutes">Pre-defined Routes</label>
                    </div>
                    <div class="route-option">
                        <input type="radio" id="tripDesign" name="routePreference" value="trip-design">
                        <label for="tripDesign">Trip Design</label>
                    </div>
                </div>
                
                <!-- Pre-defined routes section (hidden by default) -->
                <div class="predefined-routes-section" id="predefinedRoutesSection" style="display: none;">
                    <div class="question-title" style="margin-top: 20px; margin-bottom: 15px;">Available Pre-defined Routes:</div>
                    <div class="route-list">
                        <div class="route-item">
                            <input type="radio" id="route1" name="selectedRoute" value="route1">
                            <label for="route1">Route 1: Cape Town → Stellenbosch → Garden Route</label>
                        </div>
                        <div class="route-item">
                            <input type="radio" id="route2" name="selectedRoute" value="route2">
                            <label for="route2">Route 2: Kruger Safari → Garden Route → Cape Town</label>
                        </div>
                        <div class="route-item">
                            <input type="radio" id="route3" name="selectedRoute" value="route3">
                            <label for="route3">Route 3: Wine Region → Whale Coast → Garden Route</label>
                        </div>
                        <div class="route-item">
                            <input type="radio" id="route4" name="selectedRoute" value="route4">
                            <label for="route4">Route 4: Eastern Cape → Kwazulu-Natal → North</label>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Conditional Questions Container -->
            <div id="conditionalQuestionsContainer" style="display: none;">
                <!-- Question 5: How many Nights? -->
                <div class="form-group">
                    <div class="question-title">5) How many Nights?</div>
                
                <div class="nights-grid">
                    <div class="night-block">
                        <input type="radio" id="week1" name="nightRange" value="1-week">
                        <label for="week1">1 Week</label>
                    </div>
                    <div class="night-block">
                        <input type="radio" id="nights10" name="nightRange" value="10-nights">
                        <label for="nights10">10 Nights</label>
                    </div>
                    <div class="night-block">
                        <input type="radio" id="nights14" name="nightRange" value="14-nights">
                        <label for="nights14">14 Nights</label>
                    </div>
                    <div class="night-block">
                        <input type="radio" id="nights21" name="nightRange" value="21-nights">
                        <label for="nights21">21 Nights</label>
                    </div>
                </div>
                
                <div class="exact-nights-section">
                    <div class="checkbox-container">
                        <input type="checkbox" id="exactNights" name="exactNights">
                        <label for="exactNights">Exact number of nights</label>
                    </div>
                    <div class="exact-input" id="exactInputContainer">
                        <label for="exactNightCount">Number of nights:</label>
                        <input type="number" id="exactNightCount" name="exactNightCount" min="1" max="365" placeholder="0">
                    </div>
                </div>
            </div>

            <!-- Question 5: Is this a golf trip? -->
            <div class="form-group">
                <div class="question-title">5) Is this a golf trip?</div>
                
                <div class="golf-grid">
                    <div class="golf-option">
                        <input type="radio" id="golfYes" name="golfTrip" value="yes">
                        <label for="golfYes">Yes</label>
                    </div>
                    <div class="golf-option">
                        <input type="radio" id="golfNo" name="golfTrip" value="no">
                        <label for="golfNo">No</label>
                    </div>
                </div>
                
                <div class="golf-details" id="golfDetails">
                    <div class="golf-rounds-input">
                        <label for="golfRounds">More or less, how many rounds of golf?</label>
                        <input type="number" id="golfRounds" name="golfRounds" min="1" max="50" placeholder="0">
                    </div>
                </div>
            </div>

            <!-- Question 6: Where would you like to go? -->
            <div class="form-group">
                <div class="question-title">6) Where would you like to go?</div>
                <div class="destination-container">
                    <div class="destination-search-container">
                        <input type="text" class="destination-search-input" id="destinationSearch" placeholder="Type to search destinations...">
                        <div class="destination-suggestions" id="destinationSuggestions"></div>
                    </div>
                    <ul class="destination-list" id="destinationList">
                        <!-- Destinations will be generated by JavaScript -->
                    </ul>
                </div>
            </div>

            <!-- General Section with header -->
            <div class="section-title">General</div>
            
            <!-- Question 7: What level of travel? -->
            <div class="form-group">
                <div class="question-title">7) What level of travel?</div>
                <div class="travel-level-grid">
                    <div class="travel-level-option">
                        <input type="radio" id="smart" name="travelLevel" value="smart">
                        <label for="smart">
                            <span class="option-title">Smart</span>
                            <span class="option-desc">My focus is on the experiences, not necessarily a luxurious hotel</span>
                        </label>
                    </div>
                    <div class="travel-level-option">
                        <input type="radio" id="comfortable" name="travelLevel" value="comfortable">
                        <label for="comfortable">
                            <span class="option-title">Comfortable</span>
                            <span class="option-desc">I like special touches in my accommodation</span>
                        </label>
                    </div>
                    <div class="travel-level-option">
                        <input type="radio" id="luxury" name="travelLevel" value="luxury">
                        <label for="luxury">
                            <span class="option-title">Luxury</span>
                            <span class="option-desc">I prefer beautiful design and excellent service</span>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Question 8: Accommodation type -->
            <div class="form-group">
                <div class="question-title">8) Accommodation type</div>
                <div class="accommodation-type-grid">
                    <div class="accommodation-option">
                        <input type="radio" id="bnb" name="accommodationType" value="bnb">
                        <label for="bnb">Bed & Breakfast</label>
                    </div>
                    <div class="accommodation-option">
                        <input type="radio" id="boutique" name="accommodationType" value="boutique">
                        <label for="boutique">Boutique Accommodation</label>
                    </div>
                    <div class="accommodation-option">
                        <input type="radio" id="hotel-services" name="accommodationType" value="hotel-services">
                        <label for="hotel-services">Hotel with 24 Hour service and a nice bar and pool area</label>
                    </div>
                    <div class="accommodation-option">
                        <input type="radio" id="star4" name="accommodationType" value="4-star">
                        <label for="star4">4 Star</label>
                    </div>
                    <div class="accommodation-option">
                        <input type="radio" id="star5" name="accommodationType" value="5-star">
                        <label for="star5">5 Star</label>
                    </div>
                    <div class="accommodation-option">
                        <input type="radio" id="star5-superior" name="accommodationType" value="5-star-superior">
                        <label for="star5-superior">5 Star Superior</label>
                    </div>
                </div>
            </div>

            <!-- General Notes Section -->
            <div class="form-group" style="margin-top: 30px;">
                <label for="generalNotes" class="question-title" style="font-size: 16px; font-weight: 500;">General Notes</label>
                <textarea id="generalNotes" name="generalNotes" rows="4" style="width: 96%; max-width: 100%; box-sizing: border-box; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 15px; resize: vertical;"></textarea>
            </div>
            </div>

            <button type="submit" class="submit-btn" id="submitBtn">Continue</button>
        </form>

        <!-- Selected Destinations Summary -->
        <div class="selected-destinations-container" id="selectedDestinationsSummary" style="display: none;">
            <div class="selected-destinations-title">Selected Destinations:</div>
            <ul class="selected-destinations-list" id="selectedDestinationsList"></ul>
        </div>
    </div>

    <script>
        // Generate month blocks for next 14 months
        function generateMonths() {
            const monthGrid = document.getElementById('monthGrid');
            const currentDate = new Date();
            
            // Start from next month
            currentDate.setMonth(currentDate.getMonth() + 1);
            currentDate.setDate(1); // Set to first day of month
            
            for (let i = 0; i < 14; i++) {
                const monthBlock = document.createElement('div');
                monthBlock.className = 'month-block';
                
                const monthName = currentDate.toLocaleDateString('en-US', { month: 'short' });
                const year = currentDate.getFullYear().toString().slice(-2);
                const monthValue = `${currentDate.getFullYear()}-${(currentDate.getMonth() + 1).toString().padStart(2, '0')}`;
                
                // Change from radio to checkbox for multiple selection
                monthBlock.innerHTML = `
                    <input type="checkbox" id="month-${i}" name="travelMonths" value="${monthValue}">
                    <label for="month-${i}">${monthName} ${year}</label>
                `;
                
                monthGrid.appendChild(monthBlock);
                
                // Move to next month
                currentDate.setMonth(currentDate.getMonth() + 1);
            }
            
            // Add event listeners for month selection
            document.querySelectorAll('.month-block input[type="checkbox"]').forEach(box => {
                box.addEventListener('change', function() {
                    // Clear date input when any month is selected
                    if (this.checked) {
                        document.getElementById('specificDate').value = '';
                    }
                });
            });
        }

        // Handle exact nights checkbox
        function setupExactNights() {
            const exactCheckbox = document.getElementById('exactNights');
            const exactInputContainer = document.getElementById('exactInputContainer');
            const exactInput = document.getElementById('exactNightCount');
            const nightRangeRadios = document.querySelectorAll('input[name="nightRange"]');

            exactCheckbox.addEventListener('change', function() {
                if (this.checked) {
                    exactInputContainer.classList.remove('disabled');
                    exactInput.disabled = false;
                    // Uncheck range options
                    nightRangeRadios.forEach(radio => radio.checked = false);
                } else {
                    exactInputContainer.classList.add('disabled');
                    exactInput.disabled = true;
                    exactInput.value = '';
                }
            });

            // When range is selected, uncheck exact nights
            nightRangeRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.checked) {
                        exactCheckbox.checked = false;
                        exactInputContainer.classList.add('disabled');
                        exactInput.disabled = true;
                        exactInput.value = '';
                    }
                });
            });
        }

        // Handle golf trip question
        function setupGolfQuestion() {
            const golfRadios = document.querySelectorAll('input[name="golfTrip"]');
            const golfDetails = document.getElementById('golfDetails');
            const golfRoundsInput = document.getElementById('golfRounds');

            golfRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'yes') {
                        golfDetails.classList.add('show');
                        golfRoundsInput.disabled = false;
                    } else {
                        golfDetails.classList.remove('show');
                        golfRoundsInput.disabled = true;
                        golfRoundsInput.value = '';
                    }
                });
            });
        }

        // Set minimum date for specific date input
        function setupDateInput() {
            const dateInput = document.getElementById('specificDate');
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            dateInput.min = tomorrow.toISOString().split('T')[0];
            
            // Clear selected months when specific date is entered
            dateInput.addEventListener('input', function() {
                if (this.value) {
                    document.querySelectorAll('.month-block input[type="checkbox"]').forEach(box => {
                        box.checked = false;
                    });
                }
            });
        }

        // Handle form submission
        function setupFormSubmission() {
            const form = document.getElementById('travelForm');
            
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Collect selected months
                const selectedMonths = [];
                document.querySelectorAll('input[name="travelMonths"]:checked').forEach(checkbox => {
                    selectedMonths.push({
                        value: checkbox.value,
                        text: checkbox.nextElementSibling.textContent
                    });
                });
                
                // Collect nights preference
                let nightsPreference = null;
                const selectedRange = document.querySelector('input[name="nightRange"]:checked');
                const exactNights = document.getElementById('exactNights').checked;
                const exactCount = document.getElementById('exactNightCount').value;
                
                if (exactNights && exactCount) {
                    nightsPreference = {
                        type: 'exact',
                        value: exactCount,
                        text: `${exactCount} nights exactly`
                    };
                } else if (selectedRange) {
                    nightsPreference = {
                        type: 'range',
                        value: selectedRange.value,
                        text: selectedRange.nextElementSibling.textContent.trim()
                    };
                }

                // Collect golf information
                const golfTrip = document.querySelector('input[name="golfTrip"]:checked');
                let golfInfo = null;
                if (golfTrip) {
                    golfInfo = {
                        isGolfTrip: golfTrip.value === 'yes',
                        rounds: golfTrip.value === 'yes' ? document.getElementById('golfRounds').value : null
                    };
                }
                
                // Collect selected destinations
                const selectedDestinations = getSelectedDestinations();
                
                // Collect selected hotels
                const selectedHotels = getSelectedHotels();
                
                // Collect travel level preference
                const travelLevel = document.querySelector('input[name="travelLevel"]:checked');
                
                // Collect accommodation type
                const accommodationType = document.querySelector('input[name="accommodationType"]:checked');
                
                // Collect route preference
                const routePreference = document.querySelector('input[name="routePreference"]:checked');
                const selectedRoute = document.querySelector('input[name="selectedRoute"]:checked');
                
                const formData = {
                    clientName: document.getElementById('clientName').value,
                    numTravellers: document.getElementById('numTravellers').value,
                    travelMonths: selectedMonths,
                    specificDate: document.getElementById('specificDate').value,
                    routePreference: routePreference ? {
                        value: routePreference.value,
                        text: routePreference.nextElementSibling.textContent
                    } : null,
                    selectedRoute: selectedRoute ? {
                        value: selectedRoute.value,
                        text: selectedRoute.nextElementSibling.textContent
                    } : null,
                    nightsPreference: nightsPreference,
                    golfInfo: golfInfo,
                    destinations: selectedDestinations,
                    hotels: selectedHotels,
                    travelLevel: travelLevel ? {
                        value: travelLevel.value,
                        text: travelLevel.nextElementSibling.querySelector('.option-title').textContent
                    } : null,
                    accommodationType: accommodationType ? {
                        value: accommodationType.value,
                        text: accommodationType.nextElementSibling.textContent
                    } : null,
                    generalNotes: document.getElementById('generalNotes').value,
                    timestamp: new Date().toISOString()
                };
                
                console.log('Form Data:', formData);
                
                // n8n webhook URL
                const webhookUrl = 'https://n8n-utni.onrender.com/webhook/a50bcb3f-8b8a-4628-9e35-75c68a9f50b9';
                
                // Submit data to n8n webhook
                fetch(webhookUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                })
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Success:', data);
                    alert('Form submitted successfully!');
                    // Here you could redirect to next step or show success message
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('There was an error submitting the form. Please try again.');
                });
                
                // Also log data to console for debugging
                console.log('Form Data:', formData);
            });
        }

        // Destination data structure
        const destinationsData = [
            {
                id: 'cape-town',
                name: 'Cape Town',
                subDestinations: [
                    {
                        id: 'cape-town-city',
                        name: 'Cape Town',
                        subDestinations: [
                            { id: 'city center', name: 'City Center' },
                            { id: 'constantia', name: 'Constantia' },
                            { id: 'atlantic seabord', name: 'Atlantic Seabord' }
                        ]
                    },
                    {
                        id: 'cape-safari',
                        name: 'Safari',
                        subDestinations: [
                            { id: 'sanbona', name: 'Sanbona Game Reserve' },
                            { id: 'aquila', name: 'Aquila Game Reserve' },
                            { id: 'inverdoorn', name: 'Inverdoorn Game Reserve' }
                        ]
                    }
                ]
            },
            {
                id: 'stellenbosch-wineregion',
                name: 'Stellenbosch Wineregion',
                subDestinations: [
                    {
                        id: 'wine-region',
                        name: 'Wine Region',
                        subDestinations: [
                            { id: 'stellenbosch', name: 'Stellenbosch' },
                            { id: 'franschhoek', name: 'Franschhoek' },
                            { id: 'somerset-west', name: 'Somerset West' },
                            { id: 'paarl', name: 'Paarl' }
                        ]
                    }
                ]
            },
            {
                id: 'n2-route62',
                name: 'N2 & Route 62',
                subDestinations: [
                    { id: 'robertson-montagu', name: 'Robertson/ Montagu' },
                    { id: 'swellendam-heidelberg', name: 'Swellendam/ Heidelberg' }
                ]
            },
            {
                id: 'oudtshoorn',
                name: 'Oudtshoorn',
                subDestinations: [
                    { id: 'oudtshoorn', name: 'Oudtshoorn' }
                ]
            },
            {
                id: 'whale-coast',
                name: 'Whale Coast',
                subDestinations: [
                    { id: 'hermanus', name: 'Hermanus' },
                    { id: 'gansbaai', name: 'Gansbaai' },
                    { id: 'overberg/ agulhas', name: 'Overberg/ Agulhas' }
                ]
            },
            {
                id: 'garden-route',
                name: 'Garden Route',
                subDestinations: [
                    { id: 'knysna', name: 'Knysna' },
                    { id: 'plettenberg', name: 'Plettenberg Bay' },
                    { id: 'george', name: 'George' },
                    { id: 'st. francis-bay', name: 'St. Francis Bay' },
                    {
                        id: 'gr-golfresort',
                        name: 'Golfresort',
                        subDestinations: [
                            { id: 'fancourt', name: 'Fancourt' },
                            { id: 'pezula', name: 'Pezula' },
                            { id: 'simola', name: 'Simola' }
                        ]
                    },
                    {
                        id: 'gr-safari',
                        name: 'Safari',
                        subDestinations: [
                            { id: 'gondwana', name: 'Gondwana Game Reserve' },
                            { id: 'botlierskop', name: 'Botlierskop Game Reserve' }
                        ]
                    }
                ]
            },
            {
                id: 'north',
                name: 'North',
                subDestinations: [
                    { id: 'north-west', name: 'North West' },
                    { id: 'mpumalanga', name: 'Mpumalanga' },
                    { id: 'limpopo', name: 'Limpopo' },
                    { id: 'dullstroom', name: 'Dullstroom' }
                ]
            },
            {
                id: 'eastern-cape',
                name: 'Eastern Cape',
                subDestinations: [
                    { id: 'st-francis', name: 'St Francis Bay/Cape St Francis' },
                    { id: 'port-elizabeth', name: 'Port Elizabeth' },
                    {
                        id: 'ec-safari',
                        name: 'Safari',
                        subDestinations: [
                            { id: 'kariega', name: 'Kariega Game Reserve' },
                            { id: 'shamwari', name: 'Shamwari Game Reserve' },
                            { id: 'lalibela', name: 'Lalibela Game Reserve' },
                            { id: 'amakhala', name: 'Amakhala Game Reserve' },
                            { id: 'addo', name: 'Addo National Park' },
                            { id: 'pumba', name: 'Pumba Game Reserve' },
                            { id: 'kuzuko', name: 'Kuzuko Game Reserve' }
                        ]
                    }
                ]
            },
            {
                id: 'kwazulu-natal',
                name: 'Kwazulu-Natal',
                subDestinations: [
                    { id: 'durban', name: 'Durban/Ballito/Umhlanga' },
                    { id: 'south-coast', name: 'South Coast' },
                    { id: 'north coast', name: 'North Coast' },
                    {
                        id: 'kzn-safari',
                        name: 'Safari',
                        subDestinations: [
                            { id: 'phinda', name: 'Phinda Game Reserve' },
                            { id: 'mkhuze', name: 'Mkhuze Falls Game Reserve' },
                            { id: 'namibiti', name: 'Namibiti Game Reserve' }
                        ]
                    }
                ]
            },
            {
                id: 'kruger',
                name: 'Kruger National Park & Surroundings',
                subDestinations: [
                    { id: 'white-river', name: 'White River' },
                    { id: 'hazyview', name: 'Hazyview' },
                    { id: 'hoedspruit', name: 'Hoedspruit' },
                    {
                        id: 'kruger-safari',
                        name: 'Safari',
                        subDestinations: [
                            { id: 'public-kruger', name: 'Public Kruger National Park' },
                            { id: 'private-kruger', name: 'Private Game Reserve Kruger National Park' },
                            { id: 'sabi-sands', name: 'Sabi Sands' },
                            { id: 'thornybush', name: 'Thornybush' },
                            { id: 'timbavati', name: 'Timbavati' },
                            { id: 'surprise-me', name: 'Surprise me!' }
                        ]
                    }
                ]
            },
            {
                id: 'other-safari',
                name: 'Other Safari Destinations',
                subDestinations: [
                    {
                        id: 'malaria-free',
                        name: 'Malaria Free',
                        subDestinations: [
                            { id: 'madikwe', name: 'Madikwe' },
                            { id: 'pilansberg', name: 'Pilansberg' },
                            { id: 'waterberg', name: 'Waterberg' }
                        ]
                    },
                    {
                        id: 'botswana',
                        name: 'Botswana',
                        subDestinations: [
                            { id: 'okavango', name: 'Okavango Delta' },
                            { id: 'chobe', name: 'Chobe' }
                        ]
                    },
                    { id: 'zambia-zimbabwe', name: 'Zambia/Zimbabwe' },
                    { id: 'victoria-falls', name: 'Victoria Falls' }
                ]
            },
            {
                id: 'other-golf',
                name: 'Other Golf Destinations',
                subDestinations: [
                    { id: 'sun-city', name: 'Sun City' },
                    { id: 'dullstroom', name: 'Dullstroom (Ernie Els Highlands Gate)' },
                    { id: 'johannesburg', name: 'Johannesburg' },
                    { id: 'zebula', name: 'Zebula' },
                    { id: 'pinnacle-point', name: 'Pinnacle Point' }
                ]
            },
            {
                id: 'must-have-golf',
                name: 'Must Have Golf Courses',
                subDestinations: [
                    { id: 'pearl-valley', name: 'Pearl Valley' },
                    { id: 'steenberg', name: 'Steenberg' },
                    { id: 'arabella-golf', name: 'Arabella' },
                    { id: 'de-zalze', name: 'De Zalze' },
                    { id: 'erinvale', name: 'Erinvale' },
                    { id: 'fancourt-golf', name: 'Fancourt' },
                    { id: 'leopard-creek', name: 'Leopard Creek' },
                    { id: 'st-francis-links', name: 'St Francis Links' },
                    { id: 'simola-golf', name: 'Simola' },
                    { id: 'pezula-golf', name: 'Pezula' },
                    { id: 'zimbali', name: 'Zimbali' }
                ]
            }
        ];

        // Hotel data structure
        const hotelsData = [
          // City Center
          { id: 'cape-grace', name: 'Cape Grace', regionId: 'cape-town', subRegionId: 'city center' },
          { id: 'the-silo', name: 'The Silo', regionId: 'cape-town', subRegionId: 'city center' },
          { id: 'belmond-mount-nelson', name: 'Belmond Mount Nelson', regionId: 'cape-town', subRegionId: 'city center' },
          { id: 'one-only-cape-town', name: 'One & Only Cape Town', regionId: 'cape-town', subRegionId: 'city center' },
          { id: 'atzaro', name: 'Atzaro', regionId: 'cape-town', subRegionId: 'city center' },
          { id: 'cape-cadogan', name: 'Cape Cadogan', regionId: 'cape-town', subRegionId: 'city center' },
          { id: 'more-quarters', name: 'More Quarters', regionId: 'cape-town', subRegionId: 'city center' },
          { id: 'dock-house', name: 'Dock House', regionId: 'cape-town', subRegionId: 'city center' },
          { id: 'welgelegen-house', name: 'Welgelegen House', regionId: 'cape-town', subRegionId: 'city center' },
          { id: 'queen-victoria', name: 'Queen Victoria', regionId: 'cape-town', subRegionId: 'city center' },
          { id: 'radisson-waterfront', name: 'Radisson Waterfront', regionId: 'cape-town', subRegionId: 'city center' },
          { id: 'labotessa', name: 'Labotessa', regionId: 'cape-town', subRegionId: 'city center' },
          { id: 'noah-house', name: 'Noah House', regionId: 'cape-town', subRegionId: 'city center' },
          { id: 'kaap-mooi', name: 'Kaap Mooi', regionId: 'cape-town', subRegionId: 'city center' },
          { id: 'the-winchester', name: 'The Winchester', regionId: 'cape-town', subRegionId: 'city center' },
          { id: 'radisson-red', name: 'Radisson Red', regionId: 'cape-town', subRegionId: 'city center' },
          { id: 'portswood', name: 'Portswood', regionId: 'cape-town', subRegionId: 'city center' },
          { id: 'commodore', name: 'Commodore', regionId: 'cape-town', subRegionId: 'city center' },
          { id: 'victoria-alfred', name: 'Victoria & Alfred', regionId: 'cape-town', subRegionId: 'city center' },
          { id: 'derwent-house', name: 'Derwent House', regionId: 'cape-town', subRegionId: 'city center' },
          { id: '2in1-kensington', name: '2in1 Kensington', regionId: 'cape-town', subRegionId: 'city center' },
          { id: 'kensington-place', name: 'Kensington Place', regionId: 'cape-town', subRegionId: 'city center' },
          { id: 'four-rosmead', name: 'Four Rosmead', regionId: 'cape-town', subRegionId: 'city center' },
          { id: 'cape-riviera', name: 'Cape Riviera', regionId: 'cape-town', subRegionId: 'city center' },
          { id: 'three-boutique-hotel', name: 'Three Boutique Hotel', regionId: 'cape-town', subRegionId: 'city center' },
          { id: 'breakwater-lodge', name: 'Breakwater Lodge', regionId: 'cape-town', subRegionId: 'city center' },
          // Atlantic Seaboard
          { id: '12-apostles', name: '12 Apostles', regionId: 'cape-town', subRegionId: 'atlantic seabord' },
          { id: 'compass-house', name: 'Compass House', regionId: 'cape-town', subRegionId: 'atlantic seabord' },
          { id: 'pod-boutique-hotel', name: 'POD Boutique Hotel', regionId: 'cape-town', subRegionId: 'atlantic seabord' },
          { id: '21-nettleton', name: '21 Nettleton', regionId: 'cape-town', subRegionId: 'atlantic seabord' },
          { id: 'ellerman-house', name: 'Ellerman House', regionId: 'cape-town', subRegionId: 'atlantic seabord' },
          { id: 'azamare', name: 'Azamare', regionId: 'cape-town', subRegionId: 'atlantic seabord' },
          { id: 'clarendon-bantry-bay', name: 'Clarendon Bantry Bay', regionId: 'cape-town', subRegionId: 'atlantic seabord' },
          { id: 'sea-five-boutique-hotel', name: 'Sea Five Boutique Hotel', regionId: 'cape-town', subRegionId: 'atlantic seabord' },
          { id: 'lions-eye', name: 'Lions Eye', regionId: 'cape-town', subRegionId: 'atlantic seabord' },
          { id: 'the-bay', name: 'The Bay', regionId: 'cape-town', subRegionId: 'atlantic seabord' },
          { id: 'the-marly', name: 'The Marly', regionId: 'cape-town', subRegionId: 'atlantic seabord' },
          { id: 'blue-views-sc', name: 'Blue Views (SC)', regionId: 'cape-town', subRegionId: 'atlantic seabord' },
          { id: 'south-beach', name: 'South Beach', regionId: 'cape-town', subRegionId: 'atlantic seabord' },
          { id: 'walden-suites', name: 'Walden Suites', regionId: 'cape-town', subRegionId: 'atlantic seabord' },
          { id: 'ocean-view-house', name: 'Ocean View House', regionId: 'cape-town', subRegionId: 'atlantic seabord' },
          { id: 'blackheath-lodge', name: 'Blackheath Lodge', regionId: 'cape-town', subRegionId: 'atlantic seabord' },
          { id: 'o-on-kloof', name: 'O on Kloof', regionId: 'cape-town', subRegionId: 'atlantic seabord' },
          { id: 'otwo-hotel', name: "O'Two Hotel", regionId: 'cape-town', subRegionId: 'atlantic seabord' },
          { id: 'diamond-house', name: 'Diamond House', regionId: 'cape-town', subRegionId: 'atlantic seabord' },
          { id: 'romney-park', name: 'Romney Park', regionId: 'cape-town', subRegionId: 'atlantic seabord' },
          { id: 'cape-rose-cottage', name: 'Cape Rose Cottage', regionId: 'cape-town', subRegionId: 'atlantic seabord' },
          { id: 'president-hotel', name: 'President Hotel', regionId: 'cape-town', subRegionId: 'atlantic seabord' },
          { id: 'royal-boutique', name: 'Royal Boutique', regionId: 'cape-town', subRegionId: 'atlantic seabord' },
          // Constantia
          { id: 'steenberg-hotel', name: 'Steenberg Hotel', regionId: 'cape-town', subRegionId: 'constantia' },
          { id: 'villa-coloniale', name: 'Villa Coloniale', regionId: 'cape-town', subRegionId: 'constantia' },
          { id: 'cellars-hohenhort', name: 'Cellars Hohenhort', regionId: 'cape-town', subRegionId: 'constantia' },
          { id: 'villa-lions-view', name: 'Villa Lions View', regionId: 'cape-town', subRegionId: 'constantia' },
          { id: 'glen-avon', name: 'Glen Avon', regionId: 'cape-town', subRegionId: 'constantia' },
          { id: 'andros-boutique-hotel', name: 'Andros Boutique Hotel', regionId: 'cape-town', subRegionId: 'constantia' },
          { id: 'the-alphen', name: 'The Alphen', regionId: 'cape-town', subRegionId: 'constantia' },
          { id: 'last-word-constantia', name: 'Last Word Constantia', regionId: 'cape-town', subRegionId: 'constantia' },
          { id: 'vineyard-hotel', name: 'Vineyard Hotel', regionId: 'cape-town', subRegionId: 'constantia' },
          { id: 'white-lodge', name: 'White Lodge', regionId: 'cape-town', subRegionId: 'constantia' },
          // Stellenbosch Wineregion hotels
          { id: 'del-aire-graff', name: 'Del Aire Graff', regionId: 'stellenbosch-wineregion', subRegionId: 'stellenbosch' },
          { id: 'lanzerac', name: 'Lanzerac', regionId: 'stellenbosch-wineregion', subRegionId: 'stellenbosch' },
          { id: 'clouds', name: 'Clouds', regionId: 'stellenbosch-wineregion', subRegionId: 'stellenbosch' },
          { id: 'jordan', name: 'Jordan', regionId: 'stellenbosch-wineregion', subRegionId: 'stellenbosch' },
          { id: 'wedge-view', name: 'Wedge View', regionId: 'stellenbosch-wineregion', subRegionId: 'stellenbosch' },
          { id: 'majeka-house', name: 'Majeka House', regionId: 'stellenbosch-wineregion', subRegionId: 'stellenbosch' },
          { id: 'batavia', name: 'Batavia', regionId: 'stellenbosch-wineregion', subRegionId: 'stellenbosch' },
          { id: 'de-zalze-lodge', name: 'De Zalze Lodge', regionId: 'stellenbosch-wineregion', subRegionId: 'stellenbosch' },
          { id: 'van-der-stel-manor', name: 'Van der Stel Manor', regionId: 'stellenbosch-wineregion', subRegionId: 'stellenbosch' },
          { id: 'river-manor', name: 'River Manor', regionId: 'stellenbosch-wineregion', subRegionId: 'stellenbosch' },
          { id: 'boutique-hotel', name: 'Boutique Hotel', regionId: 'stellenbosch-wineregion', subRegionId: 'stellenbosch' },
          { id: 'roosenwijn', name: 'Roosenwijn', regionId: 'stellenbosch-wineregion', subRegionId: 'stellenbosch' },
          { id: 'cultivar', name: 'Cultivar', regionId: 'stellenbosch-wineregion', subRegionId: 'stellenbosch' },
          { id: 'brenaissance', name: 'Brenaissance', regionId: 'stellenbosch-wineregion', subRegionId: 'stellenbosch' },
          { id: 'devon-valley-hotel', name: 'Devon Valley Hotel', regionId: 'stellenbosch-wineregion', subRegionId: 'stellenbosch' },
          // Franschhoek
          { id: 'le-quartier-francais', name: 'Le Quartier Francais', regionId: 'stellenbosch-wineregion', subRegionId: 'franschhoek' },
          { id: 'leeu-house', name: 'Leeu House', regionId: 'stellenbosch-wineregion', subRegionId: 'franschhoek' },
          { id: 'mont-rochelle', name: 'Mont Rochelle', regionId: 'stellenbosch-wineregion', subRegionId: 'franschhoek' },
          { id: 'ludus-magnus', name: 'Ludus Magnus', regionId: 'stellenbosch-wineregion', subRegionId: 'franschhoek' },
          { id: 'akademie-guest-house', name: 'Akademie Guest House', regionId: 'stellenbosch-wineregion', subRegionId: 'franschhoek' },
          { id: 'la-cle-des-montagnes', name: 'La Cle Des Montagnes', regionId: 'stellenbosch-wineregion', subRegionId: 'franschhoek' },
          { id: 'babylonstoren', name: 'Babylonstoren', regionId: 'stellenbosch-wineregion', subRegionId: 'franschhoek' },
          { id: 'leeu-estates', name: 'Leeu Estates', regionId: 'stellenbosch-wineregion', subRegionId: 'franschhoek' },
          { id: 'la-residence', name: 'La Residence', regionId: 'stellenbosch-wineregion', subRegionId: 'franschhoek' },
          { id: 'angala-boutique-hotel', name: 'Angala Boutique Hotel', regionId: 'stellenbosch-wineregion', subRegionId: 'franschhoek' },
          { id: 'la-paris', name: 'La Paris', regionId: 'stellenbosch-wineregion', subRegionId: 'franschhoek' },
          { id: 'le-manoir-de-brendel', name: 'Le Manoir de Brendel', regionId: 'stellenbosch-wineregion', subRegionId: 'franschhoek' },
          { id: 'boschendal-werf-cottages', name: 'Boschendal Werf Cottages', regionId: 'stellenbosch-wineregion', subRegionId: 'franschhoek' },
          { id: 'macaron', name: 'Macaron', regionId: 'stellenbosch-wineregion', subRegionId: 'franschhoek' },
          { id: 'avondrood-guest-house', name: 'Avondrood Guest House', regionId: 'stellenbosch-wineregion', subRegionId: 'franschhoek' },
          { id: 'plumwood-inn', name: 'Plumwood Inn', regionId: 'stellenbosch-wineregion', subRegionId: 'franschhoek' },
          { id: 'basse-provence', name: 'Basse Provence', regionId: 'stellenbosch-wineregion', subRegionId: 'franschhoek' },
          { id: 'mont-or-franschhoek', name: "Mont d'Or Franschhoek", regionId: 'stellenbosch-wineregion', subRegionId: 'franschhoek' },
          { id: 'auberge-clermont', name: 'Auberge Clermont', regionId: 'stellenbosch-wineregion', subRegionId: 'franschhoek' },
          { id: 'protea-hotel-franschhoek', name: 'Protea Hotel Franschhoek', regionId: 'stellenbosch-wineregion', subRegionId: 'franschhoek' },
          // Paarl
          { id: 'grand-roche', name: 'Grand Roche', regionId: 'stellenbosch-wineregion', subRegionId: 'paarl' },
          { id: 'palmiet-valley-estate', name: 'Palmiet Valley Estate', regionId: 'stellenbosch-wineregion', subRegionId: 'paarl' },
          { id: 'the-lighthouse-boutique-suites', name: 'The Lighthouse Boutique Suites', regionId: 'stellenbosch-wineregion', subRegionId: 'paarl' },
          { id: 'd-olyfboom-estate', name: "d'Olyfboom Estate", regionId: 'stellenbosch-wineregion', subRegionId: 'paarl' },
          { id: 'pearl-valley-hotel', name: 'Pearl Valley Hotel', regionId: 'stellenbosch-wineregion', subRegionId: 'paarl' },
          // Somerset West
          { id: 'silver-forest', name: 'Silver Forest', regionId: 'stellenbosch-wineregion', subRegionId: 'somerset-west' },
          { id: 'erinvale-hotel', name: 'Erinvale Hotel', regionId: 'stellenbosch-wineregion', subRegionId: 'somerset-west' },
          { id: 'spanish-farm-guest-lodge', name: 'Spanish Farm Guest Lodge', regionId: 'stellenbosch-wineregion', subRegionId: 'somerset-west' },
          { id: 'willowbrook-guest-lodge', name: 'Willowbrook Guest Lodge', regionId: 'stellenbosch-wineregion', subRegionId: 'somerset-west' },
          { id: 'krystal-beach-hotel', name: 'Krystal Beach Hotel', regionId: 'stellenbosch-wineregion', subRegionId: 'somerset-west' },
          { id: 'nh-the-lord-charles', name: 'NH The Lord Charles', regionId: 'stellenbosch-wineregion', subRegionId: 'somerset-west' },
          // Whale Coast hotels
          { id: 'the-marine', name: 'The Marine', regionId: 'whale-coast', subRegionId: 'hermanus' },
          { id: 'birkenhead-house', name: 'Birkenhead House', regionId: 'whale-coast', subRegionId: 'hermanus' },
          { id: '7-on-marine', name: '7 on Marine', regionId: 'whale-coast', subRegionId: 'hermanus' },
          { id: 'abalone-lodge', name: 'Abalone Lodge', regionId: 'whale-coast', subRegionId: 'hermanus' },
          { id: 'schulphoek-house', name: 'Schulphoek House', regionId: 'whale-coast', subRegionId: 'hermanus' },
          { id: 'one-marine-drive', name: 'One Marine Drive', regionId: 'whale-coast', subRegionId: 'hermanus' },
          { id: 'arabella-kleinmond', name: 'Arabella (Kleinmond)', regionId: 'whale-coast', subRegionId: 'hermanus' },
          { id: 'whale-rock-lodge', name: 'Whale Rock Lodge', regionId: 'whale-coast', subRegionId: 'hermanus' },
          { id: 'on-the-cliff-guest-lodge', name: 'On The Cliff Guest Lodge', regionId: 'whale-coast', subRegionId: 'hermanus' },
          { id: 'auberge-burgundy', name: 'Auberge Burgundy', regionId: 'whale-coast', subRegionId: 'hermanus' },
          { id: 'hermanus-boutique-hotel', name: 'Hermanus Boutique Hotel', regionId: 'whale-coast', subRegionId: 'hermanus' },
          { id: 'misty-waves', name: 'Misty Waves', regionId: 'whale-coast', subRegionId: 'hermanus' },
          { id: 'harbour-house-hotel', name: 'Harbour House Hotel', regionId: 'whale-coast', subRegionId: 'hermanus' },
          { id: 'bamboo-guesthouse', name: 'Bamboo Guesthouse', regionId: 'whale-coast', subRegionId: 'hermanus' },
          { id: 'sandbaai-country-house', name: 'Sandbaai Country House', regionId: 'whale-coast', subRegionId: 'hermanus' },
          { id: 'baleia-guest-lodge', name: 'Baleia Guest Lodge', regionId: 'whale-coast', subRegionId: 'hermanus' },
          // Gansbaai
          { id: 'sea-star-lodge', name: 'Sea Star Lodge', regionId: 'whale-coast', subRegionId: 'gansbaai' },
          { id: 'romans-villa', name: 'Romans Villa', regionId: 'whale-coast', subRegionId: 'gansbaai' },
          { id: 'the-roundhouse', name: 'The Roundhouse', regionId: 'whale-coast', subRegionId: 'gansbaai' },
          // Overberg/Agulhas
          { id: 'lekkerwater', name: 'Lekkerwater', regionId: 'whale-coast', subRegionId: 'overberg/ agulhas' },
          { id: 'grootbos-nature-reserve', name: 'Grootbos Nature Reserve', regionId: 'whale-coast', subRegionId: 'overberg/ agulhas' },
          { id: 'morukuru-beach-ocean-house', name: 'Morukuru Beach & Ocean House', regionId: 'whale-coast', subRegionId: 'overberg/ agulhas' },
          { id: 'de-hoop-collection', name: 'De Hoop Collection', regionId: 'whale-coast', subRegionId: 'overberg/ agulhas' },
          { id: 'arniston-hotel', name: 'Arniston Hotel', regionId: 'whale-coast', subRegionId: 'overberg/ agulhas' },
          // N2 & Route 62 hotels
          { id: 'robertson-small-hotel', name: 'Robertson Small Hotel', regionId: 'n2-route62', subRegionId: 'robertson-montagu' },
          { id: 'galenia-estate-montagu', name: 'Galenia Estate Montagu', regionId: 'n2-route62', subRegionId: 'robertson-montagu' },
          { id: 'mo-rose', name: 'Mo & Rose', regionId: 'n2-route62', subRegionId: 'robertson-montagu' },
          { id: 'excelsior', name: 'Excelsior', regionId: 'n2-route62', subRegionId: 'robertson-montagu' },
          { id: 'galenia-estate', name: 'Galenia Estate', regionId: 'n2-route62', subRegionId: 'robertson-montagu' },
          { id: 'fraai-uitzicht', name: 'Fraai Uitzicht', regionId: 'n2-route62', subRegionId: 'robertson-montagu' },
          { id: 'gubas-de-hoek', name: 'Gubas de Hoek', regionId: 'n2-route62', subRegionId: 'robertson-montagu' },
          { id: 'mimosa-lodge', name: 'Mimosa Lodge', regionId: 'n2-route62', subRegionId: 'robertson-montagu' },
          { id: 'montagu-country-hotel', name: 'Montagu Country Hotel', regionId: 'n2-route62', subRegionId: 'robertson-montagu' },
          { id: 'rosendal-winery', name: 'Rosendal Winery', regionId: 'n2-route62', subRegionId: 'robertson-montagu' },
          // Swellendam/Heidelberg
          { id: 'the-hideaway', name: 'The Hideaway', regionId: 'n2-route62', subRegionId: 'swellendam-heidelberg' },
          { id: 'schoone-oordt', name: 'Schoone Oordt', regionId: 'n2-route62', subRegionId: 'swellendam-heidelberg' },
          { id: 'jan-harmsgat', name: 'Jan Harmsgat', regionId: 'n2-route62', subRegionId: 'swellendam-heidelberg' },
          { id: 'rothman-manor', name: 'Rothman Manor', regionId: 'n2-route62', subRegionId: 'swellendam-heidelberg' },
          { id: 'de-oude-pastorie', name: 'De Oude Pastorie', regionId: 'n2-route62', subRegionId: 'swellendam-heidelberg' },
          { id: 'aan-de-oever', name: 'Aan de Oever', regionId: 'n2-route62', subRegionId: 'swellendam-heidelberg' },
          // Garden Route hotels
          { id: 'fancourt-manor-house', name: 'Fancourt Manor House', regionId: 'garden-route', subRegionId: 'george' },
          { id: 'oceans-wilderness', name: 'Oceans Wilderness', regionId: 'garden-route', subRegionId: 'george' },
          { id: 'views-boutique-hotel-spa', name: 'Views Boutique Hotel & Spa', regionId: 'garden-route', subRegionId: 'george' },
          { id: 'fancourt-hotel', name: 'Fancourt Hotel', regionId: 'garden-route', subRegionId: 'george' },
          { id: 'beach-villa-wilderness', name: 'Beach Villa Wilderness', regionId: 'garden-route', subRegionId: 'george' },
          { id: 'oubaai', name: 'Oubaai', regionId: 'garden-route', subRegionId: 'george' },
          { id: 'dune-villa', name: 'Dune Villa', regionId: 'garden-route', subRegionId: 'george' },
          { id: 'ocean-view-luxury-guesthouse', name: 'Ocean View Luxury Guesthouse', regionId: 'garden-route', subRegionId: 'george' },
          { id: 'malvern-manor', name: 'Malvern Manor', regionId: 'garden-route', subRegionId: 'george' },
          { id: 'dolphin-dunes', name: 'Dolphin Dunes', regionId: 'garden-route', subRegionId: 'george' },
          { id: 'fairview-homestead', name: 'Fairview Homestead', regionId: 'garden-route', subRegionId: 'george' },
          { id: 'oakhurst-hotel', name: 'Oakhurst Hotel', regionId: 'garden-route', subRegionId: 'george' },
          { id: 'protea-hotel-king-george', name: 'Protea Hotel King George', regionId: 'garden-route', subRegionId: 'george' },
          // Knysna
          { id: 'falcons-view-manor', name: 'Falcons View Manor', regionId: 'garden-route', subRegionId: 'knysna' },
          { id: 'somervreug-guest-house', name: 'Somervreug Guest House', regionId: 'garden-route', subRegionId: 'knysna' },
          { id: 'kanonkop-house', name: 'Kanonkop House', regionId: 'garden-route', subRegionId: 'knysna' },
          { id: 'pezula', name: 'Pezula', regionId: 'garden-route', subRegionId: 'knysna' },
          { id: 'simola', name: 'Simola', regionId: 'garden-route', subRegionId: 'knysna' },
          { id: 'head-over-hills', name: 'Head over Hills', regionId: 'garden-route', subRegionId: 'knysna' },
          { id: 'turbine-hotel', name: 'Turbine Hotel', regionId: 'garden-route', subRegionId: 'knysna' },
          { id: 'villa-paradisa', name: 'Villa Paradisa', regionId: 'garden-route', subRegionId: 'knysna' },
          { id: 'amanzi-island-lodge', name: 'Amanzi Island Lodge', regionId: 'garden-route', subRegionId: 'knysna' },
          { id: 'leisure-isle-lodge', name: 'Leisure Isle Lodge', regionId: 'garden-route', subRegionId: 'knysna' },
          { id: 'knysna-views', name: 'Knysna Views', regionId: 'garden-route', subRegionId: 'knysna' },
          { id: 'hideaway-guest-house', name: 'Hideaway Guest House', regionId: 'garden-route', subRegionId: 'knysna' },
          { id: 'rexford-manor', name: 'Rexford Manor', regionId: 'garden-route', subRegionId: 'knysna' },
          { id: 'madison-manor', name: 'Madison Manor', regionId: 'garden-route', subRegionId: 'knysna' },
          { id: 'the-moorings', name: 'The Moorings', regionId: 'garden-route', subRegionId: 'knysna' },
          { id: 'knysna-greens', name: 'Knysna Greens', regionId: 'garden-route', subRegionId: 'knysna' },
          { id: 'belvidere-manor-sc-cottages', name: 'Belvidere Manor (SC Cottages)', regionId: 'garden-route', subRegionId: 'knysna' },
          // Plettenberg Bay
          { id: 'tsala-treetop-lodge', name: 'Tsala Treetop Lodge', regionId: 'garden-route', subRegionId: 'plettenberg' },
          { id: 'the-plettenberg', name: 'The Plettenberg', regionId: 'garden-route', subRegionId: 'plettenberg' },
          { id: 'kurland-country-estate', name: 'Kurland Country Estate', regionId: 'garden-route', subRegionId: 'plettenberg' },
          { id: 'robberg-beach-lodge', name: 'Robberg Beach Lodge', regionId: 'garden-route', subRegionId: 'plettenberg' },
          { id: 'hunters-country-house', name: 'Hunters Country House', regionId: 'garden-route', subRegionId: 'plettenberg' },
          { id: 'lairds-lodge', name: 'Lairds Lodge', regionId: 'garden-route', subRegionId: 'plettenberg' },
          { id: 'christiana-lodge', name: 'Christiana Lodge', regionId: 'garden-route', subRegionId: 'plettenberg' },
          { id: 'tamodi-lodge', name: 'Tamodi Lodge', regionId: 'garden-route', subRegionId: 'plettenberg' },
          { id: 'emily-moon', name: 'Emily Moon', regionId: 'garden-route', subRegionId: 'plettenberg' },
          { id: 'hog-hollow', name: 'Hog Hollow', regionId: 'garden-route', subRegionId: 'plettenberg' },
          { id: 'bitou-river-lodge', name: 'Bitou River Lodge', regionId: 'garden-route', subRegionId: 'plettenberg' },
          { id: 'piesang-valley-lodge', name: 'Piesang Valley Lodge', regionId: 'garden-route', subRegionId: 'plettenberg' },
          { id: 'southern-cross-beach-house', name: 'Southern Cross Beach House', regionId: 'garden-route', subRegionId: 'plettenberg' },
          { id: 'whalesong-hotel', name: 'Whalesong Hotel', regionId: 'garden-route', subRegionId: 'plettenberg' },
          { id: 'buffelsdam-country-house', name: 'Buffelsdam Country House', regionId: 'garden-route', subRegionId: 'plettenberg' },
          { id: 'shell-lodges-collection', name: 'Shell lodges collection', regionId: 'garden-route', subRegionId: 'plettenberg' },
          // St. Francis Bay
          { id: 'the-sands-at-st-francis', name: 'The Sands at St Francis', regionId: 'garden-route', subRegionId: 'st. francis-bay' },
          { id: 'st-francis-golf-lodge', name: 'St Francis Golf Lodge', regionId: 'garden-route', subRegionId: 'st. francis-bay' },
          { id: 'thatchwood-country-house', name: 'Thatchwood Country House', regionId: 'garden-route', subRegionId: 'st. francis-bay' },
          { id: 'oyster-bay-lodge', name: 'Oyster Bay Lodge', regionId: 'garden-route', subRegionId: 'st. francis-bay' },
          { id: 'dune-ridge-country-house', name: 'Dune Ridge Country House', regionId: 'garden-route', subRegionId: 'st. francis-bay' },
          // ... existing code ...
          // North hotels
          { id: 'the-palace-of-sun-city', name: 'The Palace of Sun City', regionId: 'north', subRegionId: 'north-west' },
          { id: 'sun-city-cascades', name: 'Sun City Cascades', regionId: 'north', subRegionId: 'north-west' },
          { id: 'sun-city-hotel', name: 'Sun City Hotel', regionId: 'north', subRegionId: 'north-west' },
          { id: 'zebula-golf-resort', name: 'Zebula Golf Resort', regionId: 'north', subRegionId: 'north-west' },
          // Mpumalanga
          { id: 'buhala', name: 'Buhala', regionId: 'north', subRegionId: 'mpumalanga' },
          { id: 'olivers-lodge', name: 'Olivers Lodge', regionId: 'north', subRegionId: 'mpumalanga' },
          { id: 'ndhula-lodge', name: 'Ndhula Lodge', regionId: 'north', subRegionId: 'mpumalanga' },
          { id: 'hippo-hollow', name: 'Hippo Hollow', regionId: 'north', subRegionId: 'mpumalanga' },
          { id: 'casa-do-sol', name: 'Casa do Sol', regionId: 'north', subRegionId: 'mpumalanga' },
          { id: 'perrys-bridge-hollow', name: 'Perry\'s Bridge Hollow', regionId: 'north', subRegionId: 'mpumalanga' },
          // Limpopo
          { id: 'safari-moon', name: 'Safari Moon', regionId: 'north', subRegionId: 'limpopo' },
          { id: 'unembeza', name: 'Unembeza', regionId: 'north', subRegionId: 'limpopo' },
          { id: 'moya-safari-villa', name: 'Moya Safari Villa', regionId: 'north', subRegionId: 'limpopo' },
          { id: 'ukuthuka-bush-lodge', name: 'Ukuthuka Bush Lodge', regionId: 'north', subRegionId: 'limpopo' },
          // Dullstroom
          { id: 'walkersons', name: 'Walkersons', regionId: 'north', subRegionId: 'dullstroom' },
          { id: 'critchley-hackle', name: 'Critchley Hackle', regionId: 'north', subRegionId: 'dullstroom' },
          // Kwazulu-Natal hotels
          { id: 'the-oyster-box', name: 'The Oyster Box', regionId: 'kwazulu-natal', subRegionId: 'durban' },
          { id: 'canelands-beach-club', name: 'Canelands Beach Club', regionId: 'kwazulu-natal', subRegionId: 'durban' },
          { id: 'zimbali-the-capital', name: 'Zimbali - The Capital. Zimbali', regionId: 'kwazulu-natal', subRegionId: 'durban' },
          { id: 'the-vineyard-on-balito', name: 'The Vineyard on Balito', regionId: 'kwazulu-natal', subRegionId: 'durban' },
          { id: 'petite-provence', name: 'Petite Provence', regionId: 'kwazulu-natal', subRegionId: 'durban' },
          // South Coast
          { id: 'days-at-sea', name: 'Days at Sea', regionId: 'kwazulu-natal', subRegionId: 'south-coast' },
          { id: 'coral-tree-colony', name: 'Coral Tree Colony', regionId: 'kwazulu-natal', subRegionId: 'south-coast' },
          { id: 'san-lameer', name: 'San Lameer', regionId: 'kwazulu-natal', subRegionId: 'south-coast' },
          // North Coast
          { id: 'lidiko-lodge', name: 'Lidiko Lodge', regionId: 'kwazulu-natal', subRegionId: 'north coast' },
          { id: 'kingfisher-lodge', name: 'Kingfisher Lodge', regionId: 'kwazulu-natal', subRegionId: 'north coast' },
          // Oudtshoorn hotels
          { id: 'rosenhof-country-house', name: 'Rosenhof Country House', regionId: 'oudtshoorn', subRegionId: 'oudtshoorn' },
          { id: 'altes-landhaus', name: 'Altes Landhaus', regionId: 'oudtshoorn', subRegionId: 'oudtshoorn' },
          { id: 'de-zeekoe', name: 'De Zeekoe', regionId: 'oudtshoorn', subRegionId: 'oudtshoorn' },
          { id: 'surval-boutique-olive-farm', name: 'Surval Boutique Olive Farm', regionId: 'oudtshoorn', subRegionId: 'oudtshoorn' },
          { id: 'montana-guest-farm', name: 'Montana Guest Farm', regionId: 'oudtshoorn', subRegionId: 'oudtshoorn' },
          { id: 'die-fonteine', name: 'Die Fonteine', regionId: 'oudtshoorn', subRegionId: 'oudtshoorn' },
          { id: 'de-denne', name: 'De Denne', regionId: 'oudtshoorn', subRegionId: 'oudtshoorn' },
          { id: 'berluda', name: 'Berluda', regionId: 'oudtshoorn', subRegionId: 'oudtshoorn' },
          { id: 'mooiplaas', name: 'Mooiplaas', regionId: 'oudtshoorn', subRegionId: 'oudtshoorn' },
          { id: 'queens-hotel', name: 'Queen\'s Hotel', regionId: 'oudtshoorn', subRegionId: 'oudtshoorn' },
          { id: 'turnberry-boutique-hotel', name: 'Turnberry Boutique Hotel', regionId: 'oudtshoorn', subRegionId: 'oudtshoorn' },
        ];

        // Generate destination selection UI
        function generateDestinations() {
            const destinationList = document.getElementById('destinationList');
            
            destinationsData.forEach((destination, index) => {
                const listItem = document.createElement('li');
                listItem.className = 'destination-item';
                listItem.dataset.id = destination.id;
                
                const mainDiv = document.createElement('div');
                mainDiv.className = 'destination-main';
                mainDiv.innerHTML = `
                    <div>
                        <span class="destination-toggle">▶</span>
                        <input type="checkbox" class="destination-checkbox" id="dest-${destination.id}" data-id="${destination.id}" data-name="${destination.name}">
                        <label for="dest-${destination.id}">${destination.name}</label>
                    </div>
                `;
                
                listItem.appendChild(mainDiv);
                
                if (destination.subDestinations && destination.subDestinations.length > 0) {
                    const subUl = document.createElement('ul');
                    subUl.className = 'sub-destinations';
                    
                    destination.subDestinations.forEach(subDest => {
                        const subLi = document.createElement('li');
                        subLi.className = 'sub-destination-item';
                        
                        if (subDest.subDestinations && subDest.subDestinations.length > 0) {
                            subLi.innerHTML = `
                                <div class="destination-checkbox-container">
                                    <span class="destination-toggle">▶</span>
                                    <input type="checkbox" class="destination-checkbox" id="dest-${subDest.id}" data-id="${subDest.id}" data-name="${subDest.name}" data-parent="${destination.id}">
                                    <label for="dest-${subDest.id}" class="sub-destination-label">${subDest.name}</label>
                                </div>
                            `;
                            
                            const nestedUl = document.createElement('ul');
                            nestedUl.className = 'nested-sub-destinations';
                            
                            subDest.subDestinations.forEach(nestedDest => {
                                const nestedLi = document.createElement('li');
                                nestedLi.className = 'nested-sub-item';
                                nestedLi.innerHTML = `
                                    <input type="checkbox" class="destination-checkbox" id="dest-${nestedDest.id}" data-id="${nestedDest.id}" data-name="${nestedDest.name}" data-parent="${subDest.id}">
                                    <label for="dest-${nestedDest.id}" class="sub-destination-label">${nestedDest.name}</label>
                                `;
                                nestedUl.appendChild(nestedLi);
                            });
                            
                            subLi.appendChild(nestedUl);
                        } else {
                            subLi.innerHTML = `
                                <input type="checkbox" class="destination-checkbox" id="dest-${subDest.id}" data-id="${subDest.id}" data-name="${subDest.name}" data-parent="${destination.id}">
                                <label for="dest-${subDest.id}" class="sub-destination-label">${subDest.name}</label>
                            `;
                        }
                        
                        subUl.appendChild(subLi);
                    });
                    
                    listItem.appendChild(subUl);
                }
                
                destinationList.appendChild(listItem);
            });
        }

        // Setup destination toggle and selection
        function setupDestinations() {
            // Generate destinations UI
            generateDestinations();
            
            // Create flat list of all destinations for search
            const allDestinations = createFlatDestinationsList();
            setupDestinationSearch(allDestinations);
            
            // Handle main destination toggle
            document.querySelectorAll('.destination-main').forEach(main => {
                main.addEventListener('click', function(e) {
                    if (!e.target.classList.contains('destination-checkbox')) {
                        const toggle = this.querySelector('.destination-toggle');
                        const parentCheckbox = this.querySelector('.destination-checkbox');
                        if (parentCheckbox && parentCheckbox.checked) {
                            toggle.classList.toggle('open');
                            toggle.textContent = toggle.classList.contains('open') ? '▼' : '▶';
                            const subDestinations = this.parentElement.querySelector('.sub-destinations');
                            if (subDestinations) {
                                subDestinations.classList.toggle('show');
                            }
                        }
                    }
                });
            });
            
            // Handle sub-destination toggle
            document.querySelectorAll('.sub-destination-item .destination-toggle').forEach(toggle => {
                toggle.parentElement.addEventListener('click', function(e) {
                    if (!e.target.classList.contains('destination-checkbox')) {
                        const parentCheckbox = this.querySelector('.destination-checkbox');
                        if (parentCheckbox && parentCheckbox.checked) {
                            toggle.classList.toggle('open');
                            toggle.textContent = toggle.classList.contains('open') ? '▼' : '▶';
                            const nestedSubDestinations = this.parentElement.querySelector('.nested-sub-destinations');
                            if (nestedSubDestinations) {
                                nestedSubDestinations.classList.toggle('show');
                            }
                        }
                        e.stopPropagation();
                    }
                });
            });
            
            // Handle checkbox selections
            document.querySelectorAll('.destination-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', function(e) {
                    e.stopPropagation();
                    
                    const parentContainer = this.closest('.destination-item, .sub-destination-item');
                    
                    // Only handle child checkboxes if THIS checkbox is a parent (i.e., has children)
                    if (parentContainer) {
                        // When parent checkbox changes state, update all children
                        // Only if this checkbox has children (not for leaf nodes)
                        const childCheckboxes = parentContainer.querySelectorAll(':scope > .sub-destinations .destination-checkbox, :scope > .nested-sub-destinations .destination-checkbox');
                        const childDropdowns = parentContainer.querySelectorAll(':scope > .sub-destinations, :scope > .nested-sub-destinations');
                        const toggle = parentContainer.querySelector('.destination-toggle');
                        if (childCheckboxes.length > 0) {
                            childCheckboxes.forEach(childCheckbox => {
                                if (!this.checked) {
                                    childCheckbox.checked = false;
                                    childCheckbox.disabled = true;
                                } else {
                                    childCheckbox.disabled = false;
                                }
                            });
                        }
                        if (childDropdowns.length > 0) {
                            childDropdowns.forEach(childDropdown => {
                                if (!this.checked) {
                                    childDropdown.classList.remove('show');
                                } else {
                                    childDropdown.classList.add('show');
                                }
                            });
                        }
                        // Automatically open dropdown when parent is checked
                        if (this.checked && toggle && childDropdowns.length > 0) {
                            toggle.classList.add('open');
                            toggle.textContent = '▼';
                        }
                        if (!this.checked && toggle && childDropdowns.length > 0) {
                            toggle.classList.remove('open');
                            toggle.textContent = '▶';
                        }
                    }
                    updateSelectedDestinations();
                    // Remove hotels if region/subregion is unchecked
                    if (!this.checked) {
                        const id = this.dataset.id;
                        const before = selectedHotels.length;
                        selectedHotels = selectedHotels.filter(hotel => hotel.regionId !== id && hotel.subRegionId !== id);
                        if (selectedHotels.length !== before) {
                            updateSelectedDestinations();
                        }
                    }
                });
            });
            
            // Initialize child checkboxes' disabled state based on parent state
            function initializeCheckboxStates() {
                // Handle main destinations first
                document.querySelectorAll('.destination-item > .destination-main .destination-checkbox').forEach(mainCheckbox => {
                    const mainItem = mainCheckbox.closest('.destination-item');
                    const childBoxes = mainItem.querySelectorAll('.sub-destinations .destination-checkbox');
                    
                    childBoxes.forEach(childBox => {
                        childBox.disabled = !mainCheckbox.checked;
                    });
                });
                
                // Handle sub-destinations with nested items
                document.querySelectorAll('.sub-destination-item .destination-checkbox').forEach(subCheckbox => {
                    const subItem = subCheckbox.closest('.sub-destination-item');
                    const nestedBoxes = subItem.querySelectorAll('.nested-sub-destinations .destination-checkbox');
                    
                    nestedBoxes.forEach(nestedBox => {
                        nestedBox.disabled = !subCheckbox.checked;
                    });
                });
            }
            
            // Add function call to initialize checkbox states
            document.addEventListener('DOMContentLoaded', function() {
                generateMonths();
                setupExactNights();
                setupGolfQuestion();
                setupDateInput();
                setupDestinations();
                setupFormSubmission();
                
                // Initialize checkbox states
                initializeCheckboxStates();
                
                // Initially disable exact input and golf rounds input
                document.getElementById('exactInputContainer').classList.add('disabled');
                document.getElementById('exactNightCount').disabled = true;
                document.getElementById('golfRounds').disabled = true;
            });
        }

        // Get all selected destinations for form submission
        function getSelectedDestinations() {
            const selected = [];
            document.querySelectorAll('.destination-checkbox:checked').forEach(checkbox => {
                selected.push({
                    id: checkbox.dataset.id,
                    name: checkbox.dataset.name,
                    parent: checkbox.dataset.parent || null
                });
            });
            return selected;
        }

        // Add getSelectedHotels
        let selectedHotels = [];
        function getSelectedHotels() {
            return selectedHotels.slice();
        }

        // Update the selected destinations summary
        function updateSelectedDestinations() {
            const selectedList = document.getElementById('selectedDestinationsList');
            const summaryContainer = document.getElementById('selectedDestinationsSummary');
            const selected = getSelectedDestinations();
            const hotels = getSelectedHotels();
            
            selectedList.innerHTML = '';
            
            if (selected.length > 0 || hotels.length > 0) {
                summaryContainer.style.display = 'block';
                
                selected.forEach(item => {
                    const listItem = document.createElement('li');
                    listItem.className = 'selected-destination-item';
                    listItem.innerHTML = `
                        ${item.name}
                        <span class="selected-destination-remove" data-id="${item.id}">✕</span>
                    `;
                    selectedList.appendChild(listItem);
                });
                
                hotels.forEach(hotel => {
                    const listItem = document.createElement('li');
                    listItem.className = 'selected-destination-item';
                    listItem.innerHTML = `
                        🏨 ${hotel.name}
                        <span class="selected-hotel-remove" data-id="${hotel.id}">✕</span>
                    `;
                    selectedList.appendChild(listItem);
                });
                
                // Handle remove buttons
                document.querySelectorAll('.selected-destination-remove').forEach(removeBtn => {
                    removeBtn.addEventListener('click', function() {
                        const destId = this.dataset.id;
                        const checkbox = document.getElementById(`dest-${destId}`);
                        if (checkbox) {
                            checkbox.checked = false;
                            updateSelectedDestinations();
                        }
                    });
                });
                // Handle remove hotel buttons
                document.querySelectorAll('.selected-hotel-remove').forEach(removeBtn => {
                    removeBtn.addEventListener('click', function() {
                        const hotelId = this.dataset.id;
                        selectedHotels = selectedHotels.filter(h => h.id !== hotelId);
                        updateSelectedDestinations();
                    });
                });
            } else {
                summaryContainer.style.display = 'none';
            }
        }

        // Create flat list of destinations for search functionality
        function createFlatDestinationsList() {
            const flatList = [];
            
            // Helper function to process destination items recursively
            function processDestination(item, path = [], parentIds = []) {
                // Add current item
                flatList.push({
                    id: item.id,
                    name: item.name,
                    path: path.length > 0 ? [...path] : [],
                    pathString: path.length > 0 ? path.join(' > ') : '',
                    parentIds: [...parentIds]
                });
                
                // Process sub-destinations if they exist
                if (item.subDestinations && item.subDestinations.length > 0) {
                    const newPath = [...path, item.name];
                    const newParentIds = [...parentIds, item.id];
                    
                    item.subDestinations.forEach(subDest => {
                        processDestination(subDest, newPath, newParentIds);
                    });
                }
            }
            
            // Process all destinations
            destinationsData.forEach(dest => {
                processDestination(dest);
            });
            
            return flatList;
        }
        
        // Setup destination search functionality
        function setupDestinationSearch(allDestinations) {
            const searchInput = document.getElementById('destinationSearch');
            const suggestionsContainer = document.getElementById('destinationSuggestions');

            // Function to filter destinations and hotels based on search query
            function filterSuggestions(query) {
                if (!query) return { destinations: [], hotels: [] };
                query = query.toLowerCase();
                const destMatches = allDestinations.filter(dest => dest.name.toLowerCase().includes(query));
                const hotelMatches = hotelsData.filter(hotel => hotel.name.toLowerCase().includes(query));
                return { destinations: destMatches.slice(0, 10), hotels: hotelMatches.slice(0, 10) };
            }

            // Function to show suggestions
            function showSuggestions(matches, query) {
                suggestionsContainer.innerHTML = '';
                let hasSuggestions = false;
                // Destinations
                if (matches.destinations.length > 0) {
                    matches.destinations.forEach(match => {
                        const item = document.createElement('div');
                        item.className = 'destination-suggestion-item';
                        item.dataset.id = match.id;
                        item.dataset.name = match.name;
                        let displayName = match.name;
                        if (match.pathString) {
                            item.innerHTML = `${displayName} <span class="destination-suggestion-path">${match.pathString}</span>`;
                        } else {
                            item.textContent = displayName;
                        }
                        item.addEventListener('click', () => {
                            selectDestination(match);
                            searchInput.value = '';
                            suggestionsContainer.style.display = 'none';
                        });
                        suggestionsContainer.appendChild(item);
                        hasSuggestions = true;
                    });
                }
                // Hotels (only show if user is typing)
                if (matches.hotels.length > 0 && query.trim().length > 0) {
                    matches.hotels.forEach(hotel => {
                        const item = document.createElement('div');
                        item.className = 'destination-suggestion-item';
                        item.dataset.id = hotel.id;
                        item.dataset.name = hotel.name;
                        item.innerHTML = `<span style='color:#1976D2;'>🏨 ${hotel.name}</span> <span class="destination-suggestion-path">Hotel</span>`;
                        item.addEventListener('click', () => {
                            selectHotel(hotel);
                            searchInput.value = '';
                            suggestionsContainer.style.display = 'none';
                        });
                        suggestionsContainer.appendChild(item);
                        hasSuggestions = true;
                    });
                }
                // Add custom destination if no exact match
                const allNames = [
                    ...matches.destinations.map(d => d.name.toLowerCase()),
                    ...matches.hotels.map(h => h.name.toLowerCase())
                ];
                if (!allNames.includes(query.toLowerCase()) && query.trim().length > 0) {
                    const addCustom = document.createElement('div');
                    addCustom.className = 'destination-suggestion-item destination-add-custom';
                    addCustom.innerHTML = `Add "<strong>${query}</strong>" as a custom destination`;
                    addCustom.addEventListener('click', () => {
                        addCustomDestination(query);
                        searchInput.value = '';
                        suggestionsContainer.style.display = 'none';
                    });
                    suggestionsContainer.appendChild(addCustom);
                    hasSuggestions = true;
                }
                suggestionsContainer.style.display = hasSuggestions ? 'block' : 'none';
            }

            // Function to select a destination from suggestions
            function selectDestination(destination) {
                // Check if it already exists in selections
                const existingCheckbox = document.querySelector(`#dest-${destination.id}`);
                if (existingCheckbox) {
                    existingCheckbox.checked = true;
                    
                    // Expand parent containers if needed
                    if (destination.parentIds && destination.parentIds.length > 0) {
                        destination.parentIds.forEach(parentId => {
                            const parentElement = document.querySelector(`.destination-item[data-id="${parentId}"]`);
                            if (parentElement) {
                                const parentToggle = parentElement.querySelector('.destination-toggle');
                                const subDestinations = parentElement.querySelector('.sub-destinations');
                                
                                if (parentToggle && !parentToggle.classList.contains('open')) {
                                    parentToggle.classList.add('open');
                                    parentToggle.textContent = '▼';
                                }
                                
                                if (subDestinations && !subDestinations.classList.contains('show')) {
                                    subDestinations.classList.add('show');
                                }
                            }
                        });
                    }
                    
                    // Scroll to the checkbox
                    existingCheckbox.scrollIntoView({ behavior: 'smooth', block: 'center' });
                    existingCheckbox.parentElement.classList.add('highlight');
                    setTimeout(() => {
                        existingCheckbox.parentElement.classList.remove('highlight');
                    }, 1500);
                } else {
                    // If it doesn't exist (should not happen with existing data)
                    addCustomDestination(destination.name);
                }
                
                updateSelectedDestinations();
            }

            // Function to select a hotel from suggestions
            function selectHotel(hotel) {
                // Check if already selected
                if (selectedHotels.some(h => h.id === hotel.id)) return;
                // Auto-select region and subregion checkboxes
                if (hotel.regionId) {
                    const regionCheckbox = document.getElementById(`dest-${hotel.regionId}`);
                    if (regionCheckbox && !regionCheckbox.checked) {
                        regionCheckbox.checked = true;
                        regionCheckbox.dispatchEvent(new Event('change', { bubbles: true }));
                        // UX: highlight and scroll
                        regionCheckbox.parentElement.classList.add('highlight');
                        regionCheckbox.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        setTimeout(() => regionCheckbox.parentElement.classList.remove('highlight'), 1200);
                    }
                }
                if (hotel.subRegionId) {
                    const subRegionCheckbox = document.getElementById(`dest-${hotel.subRegionId}`);
                    if (subRegionCheckbox && !subRegionCheckbox.checked) {
                        subRegionCheckbox.checked = true;
                        subRegionCheckbox.dispatchEvent(new Event('change', { bubbles: true }));
                        // UX: highlight and scroll
                        subRegionCheckbox.parentElement.classList.add('highlight');
                        subRegionCheckbox.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        setTimeout(() => subRegionCheckbox.parentElement.classList.remove('highlight'), 1200);
                    }
                }
                selectedHotels.push({ ...hotel });
                updateSelectedDestinations();
            }
            
            // Function to add a custom destination
            function addCustomDestination(name) {
                // Create a unique ID for the custom destination
                const customId = 'custom-' + Date.now();
                
                // Create a new checkbox for this custom destination
                const customDestItem = document.createElement('li');
                customDestItem.className = 'destination-item custom-destination';
                customDestItem.dataset.id = customId;
                
                const mainDiv = document.createElement('div');
                mainDiv.className = 'destination-main';
                mainDiv.innerHTML = `
                    <div>
                        <input type="checkbox" class="destination-checkbox" id="dest-${customId}" data-id="${customId}" data-name="${name}" checked>
                        <label for="dest-${customId}">${name} <small>(custom)</small></label>
                    </div>
                `;
                
                customDestItem.appendChild(mainDiv);
                
                // Add to the top of the list
                const destinationList = document.getElementById('destinationList');
                destinationList.insertBefore(customDestItem, destinationList.firstChild);
                
                // Attach event listener
                mainDiv.querySelector('.destination-checkbox').addEventListener('change', function(e) {
                    e.stopPropagation();
                    updateSelectedDestinations();
                });
                
                updateSelectedDestinations();
            }
            
            // Event listeners for search functionality
            searchInput.addEventListener('input', () => {
                const query = searchInput.value.trim();
                const matches = filterSuggestions(query);
                showSuggestions(matches, query);
            });
            
            searchInput.addEventListener('focus', () => {
                if (searchInput.value.trim().length > 0) {
                    const matches = filterSuggestions(searchInput.value.trim());
                    showSuggestions(matches, searchInput.value.trim());
                }
            });
            
            // Close suggestions on click outside
            document.addEventListener('click', (e) => {
                if (!searchInput.contains(e.target) && !suggestionsContainer.contains(e.target)) {
                    suggestionsContainer.style.display = 'none';
                }
            });
            
            // Keyboard navigation for suggestions
            searchInput.addEventListener('keydown', (e) => {
                const items = suggestionsContainer.querySelectorAll('.destination-suggestion-item');
                const activeItem = suggestionsContainer.querySelector('.destination-suggestion-item.active');
                
                if (items.length === 0) return;
                
                if (e.key === 'ArrowDown') {
                    e.preventDefault();
                    if (!activeItem) {
                        items[0].classList.add('active');
                    } else {
                        activeItem.classList.remove('active');
                        const nextItem = activeItem.nextElementSibling;
                        if (nextItem) {
                            nextItem.classList.add('active');
                        } else {
                            items[0].classList.add('active');
                        }
                    }
                } else if (e.key === 'ArrowUp') {
                    e.preventDefault();
                    if (!activeItem) {
                        items[items.length - 1].classList.add('active');
                    } else {
                        activeItem.classList.remove('active');
                        const prevItem = activeItem.previousElementSibling;
                        if (prevItem) {
                            prevItem.classList.add('active');
                        } else {
                            items[items.length - 1].classList.add('active');
                        }
                    }
                } else if (e.key === 'Enter') {
                    e.preventDefault();
                    if (activeItem) {
                        activeItem.click();
                    } else if (items.length > 0) {
                        items[0].click();
                    }
                } else if (e.key === 'Escape') {
                    suggestionsContainer.style.display = 'none';
                }
            });
        }
        
        // Setup route preference logic
        function setupRoutePreference() {
            const routeRadios = document.querySelectorAll('input[name="routePreference"]');
            const predefinedRoutesSection = document.getElementById('predefinedRoutesSection');
            const conditionalQuestionsContainer = document.getElementById('conditionalQuestionsContainer');
            
            routeRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'predefined') {
                        // Show pre-defined routes section
                        predefinedRoutesSection.style.display = 'block';
                        // Hide conditional questions
                        conditionalQuestionsContainer.style.display = 'none';
                    } else if (this.value === 'trip-design') {
                        // Hide pre-defined routes section
                        predefinedRoutesSection.style.display = 'none';
                        // Show conditional questions
                        conditionalQuestionsContainer.style.display = 'block';
                    }
                });
            });
        }
        
        // Initialize everything when page loads
        document.addEventListener('DOMContentLoaded', function() {
            generateMonths();
            setupExactNights();
            setupGolfQuestion();
            setupDateInput();
            setupRoutePreference();
            setupDestinations();
            setupFormSubmission();
            
            // Initialize checkbox states
            initializeCheckboxStates();
            
            // Initially disable exact input and golf rounds input
            document.getElementById('exactInputContainer').classList.add('disabled');
            document.getElementById('exactNightCount').disabled = true;
            document.getElementById('golfRounds').disabled = true;
        });
    </script>
</body>
</html>